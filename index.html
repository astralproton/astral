<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AstralX</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="overrides.css">
    <link rel="icon" href="logo.png" type="image/png">
    <style>
    /* Iframe overlay + sidebar (minimal, tweak in style.css later if desired) */
    #game-iframe-overlay{position:fixed;inset:0;background:rgba(4,6,12,0.85);backdrop-filter:blur(6px);z-index:99998;display:flex;align-items:center;justify-content:center;padding:18px}
    #game-iframe-overlay.hidden{display:none}
    .iframe-container{position:relative;width:100%;height:100%;max-width:1400px;max-height:92vh;background:#000;border-radius:12px;overflow:hidden;box-shadow:0 30px 80px rgba(0,0,0,0.75)}
    #game-iframe{width:100%;height:100%;border:0;background:#000}
    .iframe-exit{position:absolute;left:14px;top:14px;background:transparent;border:1px solid rgba(255,255,255,0.08);color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer;z-index:5}
    .iframe-toggle-arrow{position:fixed;right:18px;top:50%;transform:translateY(-50%);width:44px;height:44px;background:linear-gradient(180deg,#0f1724,#071025);border-radius:22px;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:100000;border:2px solid rgba(255,255,255,0.06);box-shadow:0 6px 18px rgba(0,0,0,0.6)}
    .iframe-toggle-arrow span{display:inline-block;color:#cfeaff;font-weight:800;transform:rotate(0deg);transition:transform .25s}
    .iframe-toggle-arrow.open span{transform:rotate(180deg)}
    .iframe-sidebar{position:fixed;right:0;top:0;height:100vh;width:320px;background:linear-gradient(180deg,#0f1220,#071025);box-shadow:-12px 0 40px rgba(0,0,0,0.7);transform:translateX(100%);transition:transform .28s ease;z-index:100001;padding:18px;display:flex;flex-direction:column;gap:14px}
    .iframe-sidebar.open{transform:translateX(0)}
    .sidebar-close{align-self:flex-end;background:none;border:none;color:#fff;font-size:22px;cursor:pointer}
    .sidebar-content{margin-top:6px}
    .sidebar-content .background-button{width:100%;padding:12px 14px;border-radius:10px;cursor:pointer}
    @media (max-width:840px){.iframe-container{max-width:100%;max-height:100%;border-radius:0}.iframe-toggle-arrow{right:10px}}
    /* Settings modal styles */
    .settings-modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(2,6,12,0.75);z-index:100000;}
    .settings-modal.hidden{display:none}
    .settings-card{width:92%;max-width:760px;background:linear-gradient(180deg,#0f1724,#071025);border-radius:12px;padding:20px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 20px 60px rgba(0,0,0,0.7);color:#e7f7ff}
    .settings-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .settings-row{display:flex;flex-direction:column;gap:6px}
    .settings-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:14px}
    .settings-card h3{margin:0 0 6px 0}
    @media(max-width:720px){.settings-grid{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <!-- Audio de Fondo (Solo para Title Screen) -->
    <audio id="bg-music" loop>
        <source src="mainmenu.mp3" type="audio/mpeg">
    </audio>

    <!-- Pantalla de Carga -->
    <div class="screen-container active" id="loader-screen">
        <img src="logo.png" alt="AstralX Logo" class="logo loading-logo">
        
        <div class="loading-bar-container">
            <div class="loading-light"></div>
        </div>
        
        <div class="status-text">CARGANDO RECURSOS...</div>
    </div>

    <!-- Pantalla de Título (Inicialmente oculta) -->
    <div class="screen-container hidden" id="title-screen">
        <div class="title-content">
            <img src="logo.png" alt="AstralX Logo" class="logo title-logo">
            <h1 class="game-title">Astral <span class="highlight">X</span></h1>
            <p class="press-start">PRESIONA <span class="key-hint">ENTER</span></p>
        </div>
    </div>

    <!-- Setup Screen OOBE -->
    <div id="setup-screen" class="hidden">
        <div class="setup-container">
            <!-- Added Setup Tabs for Login/Register toggle -->
            <div class="setup-tabs">
                <button class="tab-btn active" data-tab="register">CREAR CUENTA</button>
                <button class="tab-btn" data-tab="login">YA TENGO CUENTA</button>
            </div>

            <div class="setup-header">
                <h2 id="setup-title">CONFIGURACIÓN INICIAL</h2>
                <p id="setup-subtitle">Crea tu identidad en AstralX</p>
            </div>
            
            <!-- Added Login Form (Hidden by default) -->
            <form id="login-form" class="hidden">
                <div class="setup-grid single-col">
                    <div class="input-group">
                        <label>ID de Usuario</label>
                        <input type="text" id="login-id" placeholder="xX_Player_Xx" required>
                    </div>
                    <div class="input-group">
                        <label>Contraseña</label>
                        <input type="password" id="login-password" placeholder="••••••••" required>
                    </div>
                </div>
                <div class="form-actions">
                    <div id="login-error" class="error-msg"></div>
                    <button type="submit" class="cyber-button">
                        <span class="btn-text">INICIAR SESIÓN</span>
                        <span class="btn-glitch"></span>
                    </button>
                </div>
            </form>

            <form id="setup-form">
                <div class="setup-grid">
                    <!-- Columna Izquierda: Identidad -->
                    <div class="setup-column">
                        <h3>Identidad</h3>
                        <div class="input-group">
                            <label>ID de Usuario (Único)</label>
                            <input type="text" id="setup-id" placeholder="xX_Player_Xx" required pattern="[a-zA-Z0-9_-]+" title="Solo letras, números, guiones y guiones bajos">
                        </div>
                        <div class="input-group">
                            <label>Nombre de Usuario</label>
                            <input type="text" id="setup-name" placeholder="Tu nombre visible" required>
                        </div>
                        <div class="input-group">
                            <label>Apellido</label>
                            <input type="text" id="setup-surname" placeholder="Tu apellido">
                        </div>
                        <div class="input-group">
                            <label>Contraseña</label>
                            <input type="password" id="setup-password" placeholder="••••••••" required minlength="6">
                        </div>
                    </div>

                    <!-- Columna Derecha: Detalles -->
                    <div class="setup-column">
                        <h3>Perfil</h3>
                        <div class="input-group">
                            <label>Edad</label>
                            <input type="number" id="setup-age" placeholder="18" min="13" max="99">
                        </div>
                        <div class="input-group">
                            <label>Sexo</label>
                            <select id="setup-gender">
                                <option value="unspecified">Prefiero no decir</option>
                                <option value="male">Masculino</option>
                                <option value="female">Femenino</option>
                                <option value="other">Otro</option>
                            </select>
                        </div>
                        <div class="input-group full-width">
                            <label>Biografía</label>
                            <textarea id="setup-bio" placeholder="Cuéntanos sobre ti..." rows="3"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Avatar Section -->
                <div class="avatar-section">
                    <h3>Avatar</h3>
                    <div class="avatar-preview-container">
                        <img id="avatar-preview" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzQxNjllMSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik0yMCAyMXYtMmEtNCA0IDAgMCAwLTQtNEg4YS00IDQgMCAwIDAtNCA0djIiPjwvcGF0aD48Y2lyY2xlIGN4PSIxMiIgY3k9IjciIHI9IjQiPjwvY2lyY2xlPjwvc3ZnPg==" alt="Avatar Preview">
                        <div class="avatar-inputs">
                            <input type="text" id="setup-avatar-url" placeholder="URL de la imagen (https://...)">
                            <span class="or-divider">- O -</span>
                            <input type="file" id="setup-avatar-file" accept="image/*">
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <div id="setup-error" class="error-msg"></div>
                    <button type="submit" class="cyber-button">
                        <span class="btn-text">INICIAR SISTEMA</span>
                        <span class="btn-glitch"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Contenido Principal (Inicialmente oculto) -->

    <div class="screen-container hidden" id="app-screen">
        <!-- Audio para el menú principal (después del OOBE/título) -->
        <audio id="title-music" loop>
            <source src="menuafteroobe.mp3" type="audio/mpeg">
        </audio>
        <!-- Added Floating Header with requested layout -->
        <header id="header" class="app-header">
            <div class="header-left">
                <div class="user-profile-mini">
                    <img id="header-avatar" src="data:image/svg+xml;base64,PHN2Zy..." alt="User">
                    <span id="header-username">Player</span>
                </div>
                <div class="header-actions">
                    <button class="icon-btn" id="btn-friends" title="Amigos">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                        <span id="friend-requests-indicator" class="friend-requests-indicator" style="display:none;"></span>
                    </button>
                    <button class="icon-btn" id="btn-ads" title="Anuncios">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path></svg>
                    </button>
                    <button class="icon-btn" id="btn-messages" title="Mensajes">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                    </button>
                    <button class="icon-btn" id="btn-bugs" title="Reportar Bugs">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                    </button>
                    <button class="icon-btn" id="btn-settings" title="Configuración">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"></path><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33"></path></svg>
                    </button>
                </div>
            </div>
            <div class="header-right">
                <span class="header-title">AstralX</span>
            </div>
        </header>
        <div class="content">
            <div style="display: flex; width: 100%; height: 100%; align-items: flex-start;">
                <div class="main-content" id="main-content">
                    <!-- Sección Inicio mejorada -->
                    <div id="section-home" class="content-section active">
                        <div class="home-hero" style="flex-direction:column;align-items:center;justify-content:flex-start;margin-top:60px;gap:32px;width:100%;">
                            <h1 class="home-title" style="font-size:4.2rem;text-align:center;margin-bottom:12px;margin-top:0;line-height:1.08;max-width:900px;">Bienvenido a <span class="home-title-highlight">AstralX</span></h1>
                            <p class="home-desc" style="font-size:1.45rem;text-align:center;max-width:700px;margin-bottom:24px;">Explora el universo de juegos, música y comunidad.<br>AstralX es el sucesor de <a href="https://astralproton.github.io/astral" target="_blank">AstralProton</a>. Esta nueva versión arregla todos los errores de la anterior y agrega muchas funciones nuevas, mejor diseño y más diversión.</p>
                            <div class="home-info-cards" style="justify-content:center;width:100%;max-width:1100px;">
                                <div class="home-info-card">
                                    <h2>Bienvenido de vuelta...</h2>
                                    <p>Tu nuevo portal de juegos, mejorado y con más posibilidades.</p>
                                </div>
                                <div class="home-info-card">
                                    <h2>+100 Juegos</h2>
                                    <p>Desde clásicos retro hasta novedades modernas, todo en un solo lugar.</p>
                                </div>
                                <div class="home-info-card">
                                    <h2>Comunidad ""Activa""</h2>
                                    <p>Comparte, compite y haz amigos en nuestra plataforma social integrada. (Es broma el server de discord esta bien muerto)</p>
                                </div>
                                <div class="home-info-card">
                                    <h2>Personalización</h2>
                                    <p>Perfila tu avatar, logros y preferencias para una experiencia única.</p>
                                </div>
                            </div>
                        </div>

                        <div class="home-footer-info">
                            <span>Desarrollado por GalavDev &copy; 2025</span>
                            <span>Versión Alpha</span>
                        </div>
                    </div>
                    <!-- Sección de juegos: duplicada desde Inicio y preparada para mostrar tarjetas anchas -->
                        <div id="section-games" class="content-section">
                            <div class="games-fullpage-container" style="width:100%;max-width:1200px;padding:0 18px;">
                                <div class="games-header-bar">
                                    <div class="games-search-bar" style="margin-top:12px;display:flex;justify-content:center;">
                                        <input id="games-search" type="text" placeholder="Buscar juegos por nombre..." style="width:60%;max-width:640px;padding:10px 14px;border-radius:10px;border:1px solid #2a2a3a;background:rgba(0,0,0,0.35);color:#fff;">
                                    </div>
                                </div>
                                <div id="games-grid" class="games-grid" style="margin-top:20px;">
                                    <!-- Las tarjetas de juegos serán inyectadas por script.js -->
                                </div>
                                <div id="games-empty" class="games-empty" style="display:none;">No se encontraron juegos.</div>
                            </div>
                        </div>
                    </div>
                    <!-- Sección comunidad funcional -->
                    <div id="section-community" class="content-section">
                        <div class="community-header-bar">
                            <span class="community-title">Comunidad AstralX</span>
                            <span class="community-desc">Conoce y conecta con otros jugadores</span>
                        </div>
                        <div class="community-users-list"></div>
                        <div class="community-loading" style="display:none;">Cargando usuarios...</div>
                        <div class="community-empty" style="display:none;">No hay usuarios registrados.</div>
                        <div class="community-error" style="display:none;">Error al cargar la comunidad.</div>
                    </div>
                    <!-- Sección Perfil: editar tu perfil (accesible desde drawer) -->
                    <div id="section-profile" class="content-section" style="padding:28px;">
                        <div style="max-width:820px;margin:0 auto;background:linear-gradient(165deg,rgba(18,19,26,0.95),rgba(15,23,36,0.98));padding:24px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);">
                            <h2 style="margin:0 0 12px;font-size:1.6rem;">Editar Perfil</h2>
                            <p style="margin:0 0 18px;color:rgba(200,220,255,0.7);">Aquí puedes actualizar tu nombre, avatar, bio y otros detalles de tu cuenta.</p>

                            <form id="profile-form">
                                <div style="display:grid;grid-template-columns:1fr 320px;gap:18px;align-items:start;">
                                    <div>
                                        <div class="input-group">
                                            <label>ID de usuario (no editable)</label>
                                            <input type="text" id="profile-id" disabled>
                                        </div>
                                        <div class="input-group">
                                            <label>Nombre visible</label>
                                            <input type="text" id="profile-name">
                                        </div>
                                        <div class="input-group">
                                            <label>Apellido</label>
                                            <input type="text" id="profile-surname">
                                        </div>
                                        <div class="input-group">
                                            <label>Edad</label>
                                            <input type="number" id="profile-age" min="13" max="120">
                                        </div>
                                        <div class="input-group">
                                            <label>Sexo</label>
                                            <select id="profile-gender">
                                                <option value="unspecified">Prefiero no decir</option>
                                                <option value="male">Masculino</option>
                                                <option value="female">Femenino</option>
                                                <option value="other">Otro</option>
                                            </select>
                                        </div>
                                        <div class="input-group full-width">
                                            <label>Biografía</label>
                                            <textarea id="profile-bio" rows="4"></textarea>
                                        </div>
                                    </div>

                                    <div style="display:flex;flex-direction:column;gap:10px;align-items:center;">
                                        <div style="width:200px;text-align:center;">
                                            <img id="avatar-preview-profile" src="logo.png" alt="Avatar" style="width:140px;height:140px;border-radius:50%;object-fit:cover;border:3px solid rgba(255,255,255,0.06);background:#111;">
                                        </div>
                                        <div style="width:100%;">
                                            <label>URL de avatar</label>
                                            <input type="text" id="profile-avatar-url" placeholder="https://...">
                                        </div>
                                        <div style="width:100%;text-align:center;">- O -</div>
                                        <div style="width:100%;">
                                            <label>Subir imagen</label>
                                            <input type="file" id="profile-avatar-file" accept="image/*">
                                        </div>
                                    </div>
                                </div>

                                <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:18px;">
                                    <div id="profile-msg" style="align-self:center;color:rgba(200,220,255,0.8);"></div>
                                    <button id="profile-save-btn" class="background-button" type="button">Guardar cambios</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <!-- Modales para perfil y solicitud de amistad -->
                    <div id="userProfileModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.85);z-index:99999;align-items:center;justify-content:center;">
                        <div style="background:var(--card-bg,#181c2f);border-radius:18px;padding:2rem;max-width:600px;width:90%;max-height:80vh;overflow-y:auto;position:relative;border:2px solid var(--accent-color,#4169e1);">
                            <button onclick="closeUserProfileModal()" style="position:absolute;top:15px;right:15px;background:none;border:none;color:#fff;font-size:1.5em;cursor:pointer;line-height:1;">&times;</button>
                            <div id="userProfileModalContent"></div>
                        </div>
                    </div>
                    <!-- Sección Configuración (in-page) -->
                    <div id="section-settings" class="content-section" aria-hidden="true">
                        <div style="width:92%;max-width:760px;margin:0 auto;">
                            <div class="settings-card" role="region" aria-label="Configuración">
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                                    <h2 style="margin:0">Configuración</h2>
                                </div>
                                <div class="settings-grid">
                                    <!-- Tema option removed -->
                                    <div class="settings-row">
                                        <h3>Color de acento</h3>
                                        <input id="settings-accent" type="color" value="#4169e1">
                                    </div>
                                    <div class="settings-row">
                                        <h3>Tamaño de fuente</h3>
                                        <input id="settings-font-size" type="range" min="12" max="20" value="16">
                                        <div id="settings-font-size-value" style="font-size:0.9rem;color:rgba(200,220,255,0.8);">16px</div>
                                    </div>
                                    <div class="settings-row">
                                        <h3>Avatar visible</h3>
                                        <label style="display:flex;align-items:center;gap:8px"><input id="settings-show-avatars" type="checkbox" checked> Mostrar avatares</label>
                                    </div>
                                    <div class="settings-row">
                                        <h3>Color del header</h3>
                                        <input id="settings-header-color" type="color" value="#0f1724">
                                    </div>
                                    <div class="settings-row">
                                        <h3>Color barra inferior</h3>
                                        <input id="settings-footer-color" type="color" value="#0b0d12">
                                    </div>
                                    <div class="settings-row">
                                        <h3>Fullscreen Iframe</h3>
                                        <select id="settings-iframe-fs"><option value="iframe">Iframe</option><option value="overlay">Overlay</option></select>
                                    </div>
                                    <div class="settings-row">
                                        <h3>Reducir animaciones</h3>
                                        <label style="display:flex;align-items:center;gap:8px"><input id="settings-reduced-motion" type="checkbox"> Reducir</label>
                                    </div>
                                </div>
                                <div class="settings-actions">
                                    <button id="settings-reset" class="background-button">Restablecer</button>
                                    <button id="settings-close" class="background-button">Cerrar</button>
                                    <button id="settings-apply" class="background-button">Aplicar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Visual para la música (puedes personalizarlo luego) -->
        <div id="music-visual" style="position:absolute;top:30px;right:30px;z-index:20;"></div>
    </div>

        <!-- Settings Section previously duplicated; removed from here (moved into #main-content) -->
    <!-- Footer (styled by settings) -->
    <footer id="footer-drawer" class="footer-drawer bottom-nav" style="position:fixed;left:0;right:0;bottom:0;height:56px;display:flex;align-items:center;justify-content:center;background:#0b0d12;color:#e7f7ff;z-index:9999;border-top:1px solid rgba(255,255,255,0.03);">
        <div style="width:100%;max-width:1200px;padding:0 14px;display:flex;align-items:center;justify-content:space-between;">
            <div style="font-size:0.95rem;opacity:0.9;">© AstralX</div>
            <div style="display:flex;gap:8px;align-items:center;opacity:0.9;">
                <button class="background-button" style="padding:8px 10px;font-size:0.9rem;">Ayuda</button>
                <button class="background-button" style="padding:8px 10px;font-size:0.9rem;">Soporte</button>
            </div>
        </div>
    </footer>

    <!-- Friends Panel (modal) -->
    <div id="friendsPanel" style="display:none;position:fixed;z-index:99999;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.75);align-items:center;justify-content:center;">
        <div class="friends-panel-modal">
            <button onclick="document.getElementById('friendsPanel').style.display='none'" class="friends-panel-close">&times;</button>
            <h2 class="friends-panel-title">Amigos</h2>
            <div class="friends-panel-content">
                <div class="friends-panel-column">
                    <h3>Solicitudes</h3>
                    <ul id="friendRequestsList" class="friends-list"></ul>
                </div>
                <div class="friends-panel-column">
                    <h3>Lista de Amigos</h3>
                    <ul id="friendList" class="friends-list"></ul>
                </div>
            </div>
            <div class="friends-panel-add">
                <input id="addFriendInput" placeholder="ID de usuario">
                <textarea id="addFriendMessage" placeholder="Mensaje opcional..." rows="3" style="width:100%;margin-top:8px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff;box-sizing:border-box;"></textarea>
                <button id="addFriendBtn" class="background-button">Enviar solicitud</button>
            </div>
        </div>
    </div>
    <!-- Messages Panel (modal) -->
    <div id="messagesPanel" style="display:none;position:fixed;z-index:100000;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.85);align-items:center;justify-content:center;">
        <div class="friends-panel-modal" style="max-width:1100px;width:96%;height:85vh;display:flex;position:relative;">
            <button onclick="closeMessagesPanel()" class="friends-panel-close" style="position:absolute;right:12px;top:12px;">&times;</button>
            <aside style="width:320px;border-right:1px solid rgba(255,255,255,0.04);padding:12px;overflow:auto;background:linear-gradient(180deg,#091018,#071024);border-radius:10px;">
                <h3 style="margin-top:0;color:#e7f7ff">Conversaciones</h3>
                <div id="conversationsList" style="display:flex;flex-direction:column;gap:8px;margin-top:8px;"></div>
            </aside>
            <main style="flex:1;display:flex;flex-direction:column;background:linear-gradient(180deg,#07121a,#04101a);padding:12px;border-radius:10px;margin-left:12px;">
                <div id="chatHeader" style="padding:8px 12px;border-bottom:1px solid rgba(255,255,255,0.03);font-weight:700;color:#fff;display:flex;align-items:center;justify-content:space-between;">
                    <div id="chatHeaderTitle">Selecciona una conversación</div>
                    <div style="display:flex;gap:8px;align-items:center;">
                        <button id="chatReloadBtn" class="background-button" title="Recargar conversación" style="padding:6px 8px;min-width:38px;">⟳</button>
                    </div>
                </div>
                <div id="chatMessages" style="flex:1;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:8px;"></div>
                <div style="display:flex;gap:8px;padding-top:10px;">
                    <input id="chatInput" type="text" placeholder="Escribe un mensaje..." style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(0,0,0,0.25);color:#fff;" />
                    <button id="chatSendBtn" class="background-button primary">Enviar</button>
                </div>
            </main>
        </div>
    </div>
        <!-- Overlay para abrir juegos en iframe fullscreen -->
        <div id="game-iframe-overlay" class="hidden" aria-hidden="true">
            <div class="iframe-toggle-arrow" id="iframe-toggle-arrow" title="Abrir menú">
                <span>❯</span>
            </div>
            <div class="iframe-container">
                <iframe id="game-iframe" src="about:blank" allow="fullscreen; autoplay;" sandbox="allow-same-origin allow-scripts allow-popups allow-forms"></iframe>
            </div>
            <aside id="iframe-sidebar" class="iframe-sidebar" aria-hidden="true">
                <button id="iframe-close-sidebar" class="sidebar-close" title="Cerrar">&times;</button>
                <div class="sidebar-content">
                                        <div style="display:flex;flex-direction:column;gap:10px;">
                                            <button id="sidebar-exit-btn" class="background-button primary">Salir del juego</button>
                                            <button id="sidebar-fullscreen-btn" class="background-button">Pantalla completa</button>
                                            <button id="sidebar-exit-fullscreen-btn" class="background-button" style="display:none;background:linear-gradient(45deg,#ff6b6b,#d64545);">Salir pantalla completa</button>
                                        </div>
                </div>
            </aside>
        </div>

                <!-- Toast breve para confirmaciones (mostrado por script.js) -->
                <div id="astral-toast" class="astral-toast hidden" aria-live="polite"></div>
                <!-- Early ban-check: evita cargar el app JS si el usuario está baneado -->
                <script>
                    (function(){
                        try {
                            const API = 'https://astral-ban-api.onrender.com';
                            const userStr = localStorage.getItem('astralUser');
                            if (!userStr) return; // no hay usuario, continuar carga normal
                            const user = JSON.parse(userStr || '{}');
                            if (!user.id) return;
                            // Hacer fetch asíncrono antes de cargar app.js
                            fetch(`${API}/usuarios/${encodeURIComponent(user.id)}`).then(async (res) => {
                                if (!res.ok) return; // no bloquear si falla
                                const data = await res.json().catch(()=> ({}));
                                if (data && data.baneado) {
                                    const motivo = data.motivo_ban || 'No hay motivo especificado';
                                    const until = data.ban_until ? new Date(data.ban_until).toLocaleString() : 'Indefinido / permanente';
                                    // Simple ban UI (reemplaza body)
                                    document.title = 'Cuenta baneada - AstralX';
                                    const banHtml = `\n                    <div style="min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#07070b,#0f1220);color:#e7f7ff;padding:24px;">\n                      <div style="max-width:900px;width:100%;background:linear-gradient(180deg,#091019,#06101a);border-radius:12px;padding:22px;border:1px solid rgba(255,255,255,0.04);">\n                        <h1 style="margin:0 0 8px;color:#ff7b7b">Tu cuenta ha sido baneada</h1>\n                        <p style="margin:0 0 12px;">Lo sentimos, tu acceso a AstralX ha sido restringido.</p>\n                        <div style="background:rgba(255,255,255,0.03);padding:12px;border-radius:8px;margin-top:8px;">\n                          <strong>Motivo:</strong><div style="margin-top:6px;">${String(motivo).replace(/</g,'&lt;')}</div>\n                        </div>\n                        <div style="margin-top:10px;color:rgba(200,220,255,0.75)">\n                          <strong>Vigencia:</strong> ${String(until).replace(/</g,'&lt;')}\n                        </div>\n                        <div style="display:flex;gap:10px;margin-top:16px;">\n                          <button id="__ban_join_discord" style="padding:10px 14px;border-radius:8px;background:#2b6cff;border:none;color:#fff;cursor:pointer">Unirme al Discord</button>\n                          <button id="__ban_retry" style="padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff;cursor:pointer">Reintentar verificación</button>\n                        </div>\n                        <div style="margin-top:12px;font-size:0.9rem;color:rgba(200,220,255,0.7);">Si crees que esto es un error, unete al Discord o intenta apelar cuando sea posible.</div>\n                      </div>\n                    </div>\n                  `;
                                    document.body.innerHTML = banHtml;
                                    const j = document.getElementById('__ban_join_discord'); if (j) j.addEventListener('click', ()=> window.open('https://discord.gg/GEPrCZkWhs','_blank'));
                                    const r = document.getElementById('__ban_retry'); if (r) r.addEventListener('click', ()=> location.reload());
                                }
                            }).catch(()=>{});
                        } catch (e) { console.error('early ban check error', e); }
                    })();
                </script>
                <script src="script.js"></script>
        <script src="script-iframe.js"></script>
</body>
</html>
